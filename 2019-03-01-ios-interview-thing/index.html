<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  <title>一些iOS面试基础题总结 | 派大星星星星</title>
  
  <meta name="keywords" content="iOS">
  
  

  

  <meta name="HandheldFriendly" content="True">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <!-- meta -->
  

  <!-- link -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.css">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.6.3/css/all.min.css">
  

  
  <link rel="shortcut icon" type="image/x-icon" href="https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/fat_cat_header_small.png">
  

  
    <link rel="stylesheet" href="/style.css">
  

  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>

  
  
    <!-- ba -->
    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?420331e790ec3f2c56b1660b4958f8c3";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
    </script>
  
</head>

<body>
  
  
  <div class="cover-wrapper">
    <cover class="cover post half">
      
        
  <img class="logo" src="https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/fat_cat_header_small.png">


  <div class="m_search">
    <form name="searchform" class="form u-search-form">
      <input type="text" class="input u-search-input" placeholder>
      <i class="icon fas fa-search fa-fw"></i>
    </form>
  </div>

<div class="menu navgation">
  <ul class="h-list">
    
      
        <li>
          <a class="nav home" href="/" id="home">
            <i class="fas fa-beer fa-fw"></i>&nbsp;博客
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/categories/" id="categories">
            <i class="fas fa-folder-open fa-fw"></i>&nbsp;分类
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/tags/" id="tags">
            <i class="fas fa-tags fa-fw"></i>&nbsp;标签
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/archives/" id="archives">
            <i class="fas fa-archive fa-fw"></i>&nbsp;归档
          </a>
        </li>
      
    
  </ul>
</div>

      
    </cover>
    <header class="l_header pure">
  <div id="loading-bar-wrapper">
    <div id="loading-bar" class="pure"></div>
  </div>

	<div class="wrapper">
		<div class="nav-main container container--flex">
      <a class="logo flat-box" href="/">
        
          派大星星星星
        
      </a>
			<div class="menu navgation">
				<ul class="h-list">
          
  					
  						<li>
								<a class="nav flat-box" href="/" id="home">
									<i class="fas fa-beer fa-fw"></i>&nbsp;博客
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/categories/" id="categories">
									<i class="fas fa-folder-open fa-fw"></i>&nbsp;分类
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/tags/" id="tags">
									<i class="fas fa-tags fa-fw"></i>&nbsp;标签
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/archives/" id="archives">
									<i class="fas fa-archive fa-fw"></i>&nbsp;归档
								</a>
							</li>
      			
      		
				</ul>
			</div>

			
				<div class="m_search">
					<form name="searchform" class="form u-search-form">
						<input type="text" class="input u-search-input" placeholder="搜索">
						<i class="icon fas fa-search fa-fw"></i>
					</form>
				</div>
			
			<ul class="switcher h-list">
				
					<li class="s-search"><a class="fas fa-search fa-fw" href="javascript:void(0)"></a></li>
				
				<li class="s-menu"><a class="fas fa-bars fa-fw" href="javascript:void(0)"></a></li>
			</ul>
		</div>

		<div class="nav-sub container container--flex">
			<a class="logo flat-box"></a>
			<ul class="switcher h-list">
				<li class="s-comment"><a class="flat-btn fas fa-comments fa-fw" href="javascript:void(0)"></a></li>
        
          <li class="s-toc"><a class="flat-btn fas fa-list fa-fw" href="javascript:void(0)"></a></li>
        
			</ul>
		</div>
	</div>
</header>
	<aside class="menu-phone">
    <header>
		<nav class="menu navgation">
      <ul>
        
          
            <li>
							<a class="nav flat-box" href="/" id="home">
								<i class="fas fa-beer fa-fw"></i>&nbsp;博客
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/categories/" id="categories">
								<i class="fas fa-folder-open fa-fw"></i>&nbsp;分类
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/tags/" id="tags">
								<i class="fas fa-tags fa-fw"></i>&nbsp;标签
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/archives/" id="archives">
								<i class="fas fa-archive fa-fw"></i>&nbsp;归档
							</a>
            </li>
          
       
      </ul>
		</nav>
    </header>
	</aside>
<script>setLoadingBarProgress(40);</script>

  </div>


  <div class="l_body">
    <div class='body-wrapper'>
      <div class="l_main">
  

  
    <article id="post" class="post white-box article-type-post" itemscope itemprop="blogPost">
      


  <section class="meta">
    
    
    <div class="meta" id="header-meta">
      
        
  
    <h1 class="title">
      <a href="/2019-03-01-ios-interview-thing/">
        一些iOS面试基础题总结
      </a>
    </h1>
  


      
      <div class="new-meta-box">
        
          
        
          
            
  <div class="new-meta-item author">
    <a href="https://paaatrick.com" rel="nofollow">
      
        <i class="fas fa-user" aria-hidden="true"></i>
      
      <p>大星</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class="notlink">
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2019-03-01</p>
  </a>
</div>

          
        
          
            
  
  <div class="new-meta-item category">
    <a href="/categories/Note/" rel="nofollow">
      <i class="fas fa-folder-open" aria-hidden="true"></i>
      <p>Note</p>
    </a>
  </div>


          
        
          
            
  
    <div class="new-meta-item browse busuanzi">
      <a class="notlink">
        <i class="fas fa-eye" aria-hidden="true"></i>
        <p>
          <span id="busuanzi_value_page_pv">
            <i class="fas fa-spinner fa-spin fa-fw" aria-hidden="true"></i>
          </span>
        </p>
      </a>
    </div>
  


          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


      <section class="article typo">
        <div class="article-entry" itemprop="articleBody">
          <p>一些iOS面试基础题总结</p>
<a id="more"></a>

<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ol>
<li>多线程</li>
<li>AutoLayout</li>
<li>objc_msgSend</li>
<li>Runtime</li>
<li>消息转发</li>
<li>Category</li>
<li>NSObject 与 objc_class</li>
<li>Runloop</li>
<li>AutoreleasePool</li>
<li>iOS系统架构</li>
<li>App启动过程和优化</li>
<li>UIScrollView 的代理方法</li>
<li>响应链和事件传递</li>
<li>UIView 和 CALayer 的区别和联系</li>
<li>轮播图朴素实现的几种方法</li>
<li>TableView 和 CollectionView 必选的代理方法</li>
<li>UITableView 的优化思路</li>
</ol>
<h2 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h2><h4 id="线程之间同步"><a href="#线程之间同步" class="headerlink" title="线程之间同步"></a>线程之间同步</h4><ol>
<li>原子操作 Atomic</li>
<li>加锁（互斥锁、递归锁、读写锁）NSLock，OSSpinLock</li>
</ol>
<h4 id="多线程之间通信"><a href="#多线程之间通信" class="headerlink" title="多线程之间通信"></a>多线程之间通信</h4><ul>
<li>performSelectorOnMainThread:withObject:waitUntilDone:</li>
</ul>
<h4 id="如何保证线程安全"><a href="#如何保证线程安全" class="headerlink" title="如何保证线程安全"></a>如何保证线程安全</h4><ol>
<li>OSSpinLock 自旋锁</li>
<li>dispatch_semaphore</li>
<li>NSLock 等各种锁</li>
<li>@synchronized</li>
</ol>
<h4 id="多线程的坑"><a href="#多线程的坑" class="headerlink" title="多线程的坑"></a>多线程的坑</h4><ol>
<li>常驻线程</li>
</ol>
<p>常驻线程多了影响CPU效率</p>
<p>AFNetworking2.0因为用的NSURLConnection有缺陷，需要所在线程一直存活，所以保持了个常驻线程，3.0用了NSURLSession，可以指定回调的delegateQueue于是弃用常驻线程。</p>
<p>[runloop run]是常驻线程，[runloop runUntilDate]指定保活时长</p>
<ol start="2">
<li>并发</li>
</ol>
<p>GCD本着最大化CPU效率的原则会多创建线程，但如果是IO类操作，需要等待数据的空档会继续创建新线程导致内存失控。类似数据库操作尽量用串行队列避免多线程并发导致问题。因为创建线程需要堆栈内存，切换线程也消耗CPU。</p>
<ol start="3">
<li>死锁</li>
</ol>
<p>串行队列（如主队列）同步操作</p>
<h2 id="AutoLayout"><a href="#AutoLayout" class="headerlink" title="AutoLayout"></a>AutoLayout</h2><p>更新屏幕时，Layout Engine从上到下调用layoutSubviews()通过 Cassowary 算法计算各个子视图的位置，算出来后将子视图的 frame 从 Layout Engine 里拷贝出来，接下来的过程就跟手写frame是一样的了。iOS12优化了性能，以前元素多了会导致性能下降，现正不会了</p>
<h2 id="objc-msgSend"><a href="#objc-msgSend" class="headerlink" title="objc_msgSend"></a>objc_msgSend</h2><ol>
<li>检查这个selector是不是要忽略的</li>
<li>检查target是不是nil<ul>
<li>如果有相应处理nil的函数就跳转到该函数</li>
<li>如果没有就自动清理现场并返回，这就是OC中给nil发消息不会崩溃的原因</li>
</ul>
</li>
<li>确定不是给nil发消息后，在该class的缓存中查找方法对应的IMP实现<ul>
<li>如果找到就跳转进去</li>
<li>如果没找到就在方法分发表里继续查找，直到找到NSObject为止</li>
</ul>
</li>
<li>如果还没找到就开始消息转发，上述过程就是通过SEL快速查找IMP的过程</li>
</ol>
<h2 id="Runtime"><a href="#Runtime" class="headerlink" title="Runtime"></a>Runtime</h2><p>C语言中，编译期函数的调用就决定调用哪个函数，而OC只有在真正运行时才根据函数名称找到对应函数来调用。需要一个运行时系统来动态地创建类和对象、消息传递和转发</p>
<ol>
<li><p>讲一下 OC 的消息机制</p>
<ul>
<li>OC中的方法调用其实都是转成了objc_msgSend函数的调用，给receiver（方法调用者）发送了一条消息（selector方法名）</li>
<li>objc_msgSend底层有3大阶段:消息发送（当前类、父类中查找）、动态方法解析、消息转发</li>
<li>当递归地找不到selector时，启动消息转发：resolveInstanceMethod、resolveClassMethod、forwardingTargetForSelector</li>
</ul>
</li>
<li><p>什么是Runtime？平时项目中有用过么？</p>
<ul>
<li>OC是一门动态性比较强的编程语言，允许很多操作推迟到程序运行时再进行</li>
<li>OC的动态性就是由Runtime来支撑和实现的，Runtime是一套C语言的API，封装了很多动态性相关的函数</li>
<li>平时编写的OC代码，底层都是转换成了Runtime API进行调用</li>
</ul>
</li>
<li><p>Runtime 的应用（优点）：</p>
<ul>
<li>实现多继承 Multiple Inheritance</li>
<li>Method Swizzling -&gt; 无侵入埋点 -&gt; 使用Category进行</li>
<li>Aspect Oriented Prigramming 面向切面编程AOP -&gt; 如日志、身份验证、缓存等模块</li>
<li>isa Swizzling -&gt; KVO的实现</li>
<li>Associated Object关联对象(给Category添加属性) objc_set(get)AssociatedObject </li>
<li>动态地增加方法</li>
<li>NSCoding 的自动归档和自动解档</li>
<li>字典和模型相互转换！</li>
<li>异常保护（保护数组越界问题）</li>
</ul>
</li>
<li><p>Runtime 的缺点</p>
<ul>
<li>Method Swizzling 不是原子操作，放在+load里没问题，放在+initialize里就有问题了</li>
<li>重写方法而不调用super方法可能有问题</li>
</ul>
</li>
<li><p>Runtime 注意事项</p>
<ul>
<li>Swizzling应该总在+load中执行</li>
<li>Swizzling应该总在dispatch_once中执行 -&gt; 因为会改变全局状态所以应该只执行一次</li>
<li>+load中执行Swizzling时，不要调用[super load] -&gt; 避免偶数次执行Swizzling</li>
</ul>
</li>
</ol>
<ul>
<li>SEL其本身是一个Int类型的地址，地址中存放着方法的名字。</li>
</ul>
<h2 id="Method-Swizzling"><a href="#Method-Swizzling" class="headerlink" title="Method Swizzling"></a>Method Swizzling</h2><h4 id="几个常见方法"><a href="#几个常见方法" class="headerlink" title="几个常见方法"></a>几个常见方法</h4><ol>
<li>method_setImplementation</li>
</ol>
<p>为一个方法名设置IMP(实现)</p>
<ol start="2">
<li>method_exchangeImplementations</li>
</ol>
<p>交换两个方法名的实现，即执行两次 method_setImplementation</p>
<ol start="3">
<li>class_addMethod</li>
</ol>
<p>根据官方注释解释，这个方法用于给指定的类增加方法名和IMP(实现)，如果该已经存在这个方法名，不做事，返回NO，如果该类不存在这个方法名（即使父类存在），添加这个方法，返回YES</p>
<ol start="4">
<li>class_replaceMethod</li>
</ol>
<p>根据官方注释解释，它有两种不同的行为。当类中没有想替换的原方法时，该方法会调用 class_addMethod 来为该类增加一个新方法。若已存在，则等同于 method_setImplementation 为该方法名替换IMP(实现)</p>
<h4 id="Swizzling-模板"><a href="#Swizzling-模板" class="headerlink" title="Swizzling 模板"></a>Swizzling 模板</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="keyword">void</span>)hookClass:(Class)classObject fromSelector:(SEL)fromSelector toSelector:(SEL)toSelector &#123;</span><br><span class="line">    Class <span class="keyword">class</span> = classObject;</span><br><span class="line">    Method fromMethod = class_getInstanceMethod(<span class="keyword">class</span>, fromSelector); <span class="comment">// 得到被交换类的实例方法</span></span><br><span class="line">    Method toMethod = class_getInstanceMethod(<span class="keyword">class</span>, toSelector); <span class="comment">// 得到交换类的实例方法</span></span><br><span class="line">    <span class="keyword">if</span>(class_addMethod(<span class="keyword">class</span>, fromSelector, method_getImplementation(toMethod), method_getTypeEncoding(toMethod))) &#123;</span><br><span class="line">        class_replaceMethod(<span class="keyword">class</span>, toSelector, method_getImplementation(fromMethod), method_getTypeEncoding(fromMethod)); <span class="comment">// 进行方法的交换</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        method_exchangeImplementations(fromMethod, toMethod); <span class="comment">// 交换 IMP 指针</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="keyword">void</span>)load &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</span><br><span class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</span><br><span class="line">        Class aClass = [<span class="keyword">self</span> <span class="keyword">class</span>];</span><br><span class="line">        </span><br><span class="line">        SEL originalSelector = <span class="keyword">@selector</span>(viewWillAppear:);</span><br><span class="line">        SEL swizzledSelector = <span class="keyword">@selector</span>(xxx_viewWillAppear:);</span><br><span class="line">        </span><br><span class="line">        Method originalMethod = class_getInstanceMethod(aClass, originalSelector);</span><br><span class="line">        Method swizzledMethod = class_getInstanceMethod(aClass, swizzledSelector);</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">BOOL</span> didAddMethod =</span><br><span class="line">        class_addMethod(aClass,</span><br><span class="line">                        originalSelector,</span><br><span class="line">                        method_getImplementation(swizzledMethod),</span><br><span class="line">                        method_getTypeEncoding(swizzledMethod));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (didAddMethod) &#123;</span><br><span class="line">            class_replaceMethod(aClass,</span><br><span class="line">                                swizzledSelector,</span><br><span class="line">                                method_getImplementation(originalMethod),</span><br><span class="line">                                method_getTypeEncoding(originalMethod));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            method_exchangeImplementations(originalMethod, swizzledMethod);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="消息转发"><a href="#消息转发" class="headerlink" title="消息转发"></a>消息转发</h2><p>什么时候会报unrecognized selector的异常？</p>
<blockquote>
<p>当调用该对象上某个方法,而该对象上没有实现这个方法的时候， 可以通过“消息转发”进行解决。</p>
</blockquote>
<p>objc在向一个对象发送消息时，runtime库会根据对象的isa指针找到该对象实际所属的类，然后在该类中的方法列表以及其父类方法列表中寻找方法运行，如果，在最顶层的父类中依然找不到相应的方法时，程序在运行时会挂掉并抛出异常unrecognized selector sent to XXX 。但是在这之前，objc的运行时会给出三次拯救程序崩溃的机会：</p>
<ol>
<li>Method resolution</li>
</ol>
<p>objc运行时会调用<code>+resolveInstanceMethod:</code>或者 +resolveClassMethod:，让你有机会提供一个函数实现。如果你添加了函数，那运行时系统就会重新启动一次消息发送的过程，否则 ，运行时就会移到下一步，消息转发（Message Forwarding）。</p>
<ol start="2">
<li>Fast forwarding</li>
</ol>
<p>如果目标对象实现了<code>-forwardingTargetForSelector:</code>，Runtime 这时就会调用这个方法，给你把这个消息转发给其他对象的机会。 只要这个方法返回的不是nil和self，整个消息发送的过程就会被重启，当然发送的对象会变成你返回的那个对象。否则，就会继续Normal Fowarding。 这里叫Fast，只是为了区别下一步的转发机制。因为这一步不会创建任何新的对象，但下一步转发会创建一个NSInvocation对象，所以相对更快点。</p>
<ol start="3">
<li>Normal forwarding</li>
</ol>
<p>这一步是Runtime最后一次给你挽救的机会。首先它会发送<code>-methodSignatureForSelector:</code>消息获得函数的参数和返回值类型。如果-methodSignatureForSelector:返回nil，Runtime则会发出-doesNotRecognizeSelector:消息，程序这时也就挂掉了。如果返回了一个函数签名，Runtime就会创建一个NSInvocation对象并发送<code>-forwardInvocation:</code>消息给目标对象。</p>
<h2 id="Category"><a href="#Category" class="headerlink" title="Category"></a>Category</h2><p>通过Runtime给类添加方法，可以把类的实现分开在几个不同的文件，减少单个文件体积、不同功能组织到不同的Category里、可以由多人开发一个类、可以按需加载想要的category、可以把framework的私有方法公开</p>
<p>与extension不同的是，extension需要有类的源码才能添加，所以无法为系统类添加extension。</p>
<p>而category是运行时添加的。所以，extension可以添加实例变量，而category只能添加实例方法、类方法、协议、属性，但是不能添加实例变量。</p>
<p>category并不是完全替换掉原来类的方法，而是附加到方法列表的前面，而runtime寻找方法是顺着找的，找到category覆盖的方法后就执行了</p>
<h2 id="NSObject-与-objc-class"><a href="#NSObject-与-objc-class" class="headerlink" title="NSObject 与 objc_class"></a>NSObject 与 objc_class</h2><p>NSObject 继承自 objc_class<br>objc_class 继承自 objc_object</p>
<p><code>objc_object -&gt; objc_class -&gt; NSObject</code></p>
<p>所以OC中，类也是一个对象。</p>
<p>objc_class中，除了isa，还有3个成员变量，一个是父类的指针，一个是方法缓存，最后一个这个类的实例方法链表。</p>
<p>每个类都有单独的元类，所以类的superclass指针递归最后指向NSObject，NSObject没有超类所以指向nil。类的isa指向对应唯一的元类，每个元类的isa都指向rootMetaClass，rootMetaClass的superClass指向NSObject，isa指向自己</p>
<p>元类中保存了创建类对象以及类方法所需的所有信息</p>
<h2 id="Runloop"><a href="#Runloop" class="headerlink" title="Runloop"></a>Runloop</h2><p>可以先粗看这篇<a href="https://blog.ibireme.com/2015/05/18/runloop/" target="_blank" rel="noopener">YYKit大神ibireme的文章</a>，大概过一遍，不用纠结源码和看不懂的地方。<br>然后看这个<a href="https://v.youku.com/v_show/id_XODgxODkzODI0.html" target="_blank" rel="noopener">孙源的线下分享会视频</a>，最后再细看一遍那篇文章</p>
<h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><p>运行循环，在程序运行过程中循环做一些事情，如果没有Runloop程序执行完毕就会立即退出，如果有Runloop程序会一直运行，并且时时刻刻在等待用户的输入操作。RunLoop可以在需要的时候自己跑起来运行，在没有操作的时候就停下来休息。充分节省CPU资源，提高程序性能。简单来说就是让软件一直活着。</p>
<h4 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h4><p><img src="https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190611111951.png" alt></p>
<ul>
<li>一个线程对应一个<code>Runloop</code>，主线程的Runloop默认开启，子线程如果不手动开启就没有。</li>
<li>每个Runloop内有多个Mode，但Runloop同一时间只能执行一个Mode，换Mode需要停下切换。</li>
<li>每个Mode内有任意多个<code>Source</code>、<code>Timer</code>、<code>Observer</code></li>
</ul>
<h4 id="Timer"><a href="#Timer" class="headerlink" title="Timer"></a>Timer</h4><ul>
<li>即 <code>CFRunloopTimer</code></li>
<li><code>NSTimer</code>、<code>performSelector:afterDelay:</code>、<code>CADisplayLink</code>都是对<code>RunloopTimer</code>的封装</li>
</ul>
<h4 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h4><ul>
<li>即 <code>CFRunlopSource</code>，是Runloop的数据源抽象类</li>
<li>Source分<code>Source0</code>和<code>Source1</code></li>
<li><code>Source0</code>处理App内部事件、App自己负责管理触发、如<code>UIEvent</code>、<code>CFSocker</code></li>
<li><code>Source1</code>有Runloop和内核管理，<code>Mach Port</code>驱动，如<code>CFMachPort</code>、<code>CFMessagePort</code></li>
</ul>
<h4 id="Observer"><a href="#Observer" class="headerlink" title="Observer"></a>Observer</h4><ul>
<li>向外部报告Runloop当前状态的更改</li>
<li>框架中很多机制都由RunLoopObserver触发，如CAAnimation</li>
<li>与 AutoreleasePool 的关系：UIKit通过Observer在RunLoop两个Sleep之间对AutoreleasePool进行Pop和Push，将这次Loop中产生的Autorelease对象释放</li>
</ul>
<h4 id="CFRunLoopMode"><a href="#CFRunLoopMode" class="headerlink" title="CFRunLoopMode"></a>CFRunLoopMode</h4><ul>
<li>每个Runloop内有多个Mode，但Runloop同一时间只能执行一个Mode，换Mode需要停止当前Loop切换然后重启Loop。</li>
</ul>
<ol>
<li>默认Mode：<code>NSDefaultRunLoopMode</code>, 空闲状态、普通事件等</li>
<li>界面追踪Mode：<code>UITrackingRunLoopMode</code>, 滑动时（ScrollView）</li>
<li>私有Mode：UIInitializationRunLoopMode, App刚启动时, 不重要</li>
</ol>
<ul>
<li><code>NSRunLoopCommonModes</code>是一个集合（打标签），默认包含上面的1和2两个Mode，可以自己添加Mode进去</li>
<li>开始滑动时，会从DefaultRunLoopMode切换成UITrackingRunLoopMode，停止滑动时会切换回来</li>
<li>想让<code>NSTimer</code>滑动时也跑，默认是加到DefaultMode的，需要手动加到CommonModes里，使其滑动时也执行，<code>[(NSRunLoop) addTimer:forMode:]</code></li>
</ul>
<h4 id="RunLoop-与-GCD-的关系"><a href="#RunLoop-与-GCD-的关系" class="headerlink" title="RunLoop 与 GCD 的关系"></a>RunLoop 与 GCD 的关系</h4><ul>
<li>只在用到 main queue 时</li>
<li>GCD 中 dispatch 到 main queue 的 block 被分发到 main RunLoop 中执行</li>
</ul>
<h4 id="RunLoop-的挂起与唤醒"><a href="#RunLoop-的挂起与唤醒" class="headerlink" title="RunLoop 的挂起与唤醒"></a>RunLoop 的挂起与唤醒</h4><ul>
<li>指定用于唤醒的 mach_port 端口</li>
<li>调用 mach_msg 监听唤醒端口，被唤醒前，系统内核将这个线程挂起，停留在 mach_msg_trap 状态<br><img src="https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190611150612.png" alt></li>
<li>由另一个线程（或另一个进程中的某个线程）向内核发送该端口的msg后，trap状态被唤醒，RunLoop继续下一轮</li>
</ul>
<h4 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h4><ol>
<li>保持程序持续运行，程序一启动就会开一个主线程，主线程一开起来就会跑一个主线程对应的RunLoop,RunLoop保证主线程不会被销毁，也就保证了程序的持续运行，对于子线程可以使用run来常驻线程。</li>
<li>保证NSTimer正常运转</li>
<li>线上监测App卡顿情况</li>
<li>处理App中的各种事件（比如：触摸事件，定时器事件，Selector事件等）</li>
<li>节省CPU资源，提高程序性能，程序运行起来时，当什么操作都没有做的时候，RunLoop就告诉CUP，现在没有事情做，我要去休息，这时CUP就会将其资源释放出来去做其他的事情，当有事情做的时候RunLoop就会立马起来去做事情</li>
</ol>
<h4 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h4><ol>
<li>进入loop</li>
<li>do while 保活线程：触发Timer回调、触发Source()回调、执行block</li>
<li>进入休眠</li>
<li>等待mach_port消息（如Timer时间到、Runloop超时、被调用者唤醒）</li>
<li>唤醒，处理消息</li>
<li>判断是否进入下一个loop</li>
</ol>
<h4 id="AFNetworking的RunLoop用法"><a href="#AFNetworking的RunLoop用法" class="headerlink" title="AFNetworking的RunLoop用法"></a>AFNetworking的RunLoop用法</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="keyword">void</span>)networkRequestThreadEntryPoint:(<span class="keyword">id</span>)__unused object &#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        [[<span class="built_in">NSThread</span> currentThread] setName:<span class="string">@"AFNetworking"</span>];</span><br><span class="line">        <span class="built_in">NSRunLoop</span> *runLoop = [<span class="built_in">NSRunLoop</span> currentRunLoop];</span><br><span class="line">        [runLoop addPort:[<span class="built_in">NSMachPort</span> port] forMode:<span class="built_in">NSDefaultRunLoopMode</span>];</span><br><span class="line">        [runLoop run];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="built_in">NSThread</span> *)networkRequestThread &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">NSThread</span> *_networkRequestThread = <span class="literal">nil</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> oncePredicate;</span><br><span class="line">    <span class="built_in">dispatch_once</span>(&amp;oncePredicate, ^&#123;</span><br><span class="line">        _networkRequestThread = [[<span class="built_in">NSThread</span> alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(networkRequestThreadEntryPoint:) object:<span class="literal">nil</span>];</span><br><span class="line">        [_networkRequestThread start];</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> _networkRequestThread;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在子线程开启RunLoop，添加一个不会用到的port作为Source防止RunLoop停止</li>
<li><code>[runloop run]</code>使子线程常驻，从而接收NSURLConnection的回调</li>
<li>在AF的3.0版本里替换成NSURLSession就不需要常驻线程了</li>
</ul>
<h4 id="利用RunLoop延时加载图片"><a href="#利用RunLoop延时加载图片" class="headerlink" title="利用RunLoop延时加载图片"></a>利用RunLoop延时加载图片</h4><ul>
<li>当scrollview滑动时加载图片可能导致卡顿</li>
<li>原本做法可以通过delegate处理是否加载</li>
<li>利用RunLoop：把图片加载的方法放在<code>NSDefaultRunLoopMode</code>里，这样当滑动时就切换出了这个Mode，暂停加载</li>
</ul>
<h4 id="Crash时重启RunLoop"><a href="#Crash时重启RunLoop" class="headerlink" title="Crash时重启RunLoop"></a>Crash时重启RunLoop</h4><ul>
<li>接到 Crash 的 Signal 后手动重启 RunLoop</li>
<li>不适用于 BAD_ACCESS</li>
</ul>
<h4 id="监测卡顿的方法"><a href="#监测卡顿的方法" class="headerlink" title="监测卡顿的方法"></a>监测卡顿的方法</h4><ol>
<li>创建观察者</li>
<li>把观察者添加到主线程的Runloop的common模式下观察，然后创建一个常驻子线程专门用来监控主线程的Runloop状态</li>
<li>一旦发现runloop进入睡眠前的状态或者唤醒后的状态在设置的时间阈值内没有变化，即可判定为卡顿，用第三方库PLCrashReporter来获取堆栈信息，上报服务器。后续分析。</li>
</ol>
<h2 id="AutoreleasePool"><a href="#AutoreleasePool" class="headerlink" title="AutoreleasePool"></a>AutoreleasePool</h2><p>配合runloop的，每次runloop开启时重建自动释放池，休息前释放掉池里的东西如Timer<br>ARC下自动创建的在子线程结束后释放，手动创建的在作用域大括号结束后释放<br>底层实现 AutoReleasePoolPage 是一个双向链表，有push release pop操作</p>
<h2 id="iOS系统架构"><a href="#iOS系统架构" class="headerlink" title="iOS系统架构"></a>iOS系统架构</h2><p>四个层</p>
<ul>
<li>第一层：用户体验层：SpringBoard</li>
<li>第二层：应用框架层：CocoaTouch</li>
<li>第三层：核心框架层：Metal、图形媒体核心框架</li>
<li>第四层：Darwin层：XNU、内核、驱动</li>
</ul>
<p>iOS的可执行文件和动态库都是Mach-O格式，加载App实际就是加载Mach-O文件。</p>
<h2 id="App启动过程与优化"><a href="#App启动过程与优化" class="headerlink" title="App启动过程与优化"></a>App启动过程与优化</h2><ol>
<li><p>main()执行前</p>
<ul>
<li>加载可执行文件（App的.o文件的集合）</li>
<li>加载动态链接库，进行rebase指针调整和bind符号绑定</li>
<li>Objc Runtime 的初始处理，包括 Objc 相关类的注册、Category注册、selector 唯一性检查</li>
<li>+load()初始化<blockquote>
<p>这个阶段的优化有 1. 减少动态库加载（合并动态库）2. 减少加载启动后不会去用的类和方法 3. 少用+load，或用 +initialize替换，因为runtime 的 Method Swizzling 操作每次4ms</p>
</blockquote>
</li>
</ul>
</li>
<li><p>main()执行后</p>
<ul>
<li>指 main() 执行开始到 didFinishLaunchingWithOptions 方法里首屏渲染相关方法完成</li>
<li>配置初始化文件的IO操作</li>
<li>首屏列表大数据的读取</li>
<li>首屏渲染的大量计算<blockquote>
<p>优化方法有把各种与首屏渲染不相干的初始化挪走或子线程处理</p>
</blockquote>
</li>
</ul>
</li>
<li><p>首屏渲染完成后</p>
<ul>
<li>指 didFinishLaunchingWithOptions 作用域内执行首屏渲染之后的所有方法执行完成</li>
<li>非首屏其他业务服务模块的初始化</li>
<li>监听的注册</li>
<li>配置文件的读写<blockquote>
<p>把可能卡住主线程的方法挪走或子线程处理</p>
</blockquote>
</li>
</ul>
</li>
</ol>
<h2 id="UIScrollView-的代理方法"><a href="#UIScrollView-的代理方法" class="headerlink" title="UIScrollView 的代理方法"></a>UIScrollView 的代理方法</h2><ol>
<li>滚动完 scrollViewDidScroll </li>
<li>缩放完 scrollViewDidZoom</li>
<li>将要开始拖动 scrollViewWillBeginDragging</li>
<li>将要结束拖动 scrollViewWillEndDragging</li>
<li>滑动将要减速、 滑动减速完成</li>
<li>滚动动画完成</li>
<li>将要开始缩放、已经结束缩放</li>
</ol>
<h2 id="响应链和事件传递"><a href="#响应链和事件传递" class="headerlink" title="响应链和事件传递"></a>响应链和事件传递</h2><ol>
<li><p>hitTest方法检测看是否返回</p>
</li>
<li><p>继承<code>UIResponder</code>的类才能响应，如<code>UIApplication</code>、<code>UIView</code>、<code>UIViewController</code>。而<code>CALayer</code>是继承自<code>NSObject</code>的，不能响应</p>
</li>
<li><p>事件首先传递给<code>UIApplication</code>，然后向下分发给<code>UIWindow</code>，然后分发给最下层的<code>UIView</code>，逐步调用<code>hitTest</code>从屏内向外找，当某个<code>UIView</code>返回YES时就递归对其<code>SubView</code>执行<code>hitTest</code>，直到找到最后一个</p>
</li>
</ol>
<ul>
<li>某<code>UIView</code>不接受事件的情况：<ol>
<li>alpha &lt; 0.01</li>
<li>userInteractionEnabled = NO</li>
<li>hidden = YES</li>
</ol>
</li>
</ul>
<h2 id="UIView-和-CALayer-的区别和联系"><a href="#UIView-和-CALayer-的区别和联系" class="headerlink" title="UIView 和 CALayer 的区别和联系"></a>UIView 和 CALayer 的区别和联系</h2><ol>
<li>UIView能响应，CALayer不能</li>
<li>View的frame(和bounds)是简单返回layer的frame(bound), 而layer的frame由几个参数决定</li>
<li>UIView 是 CALayer 的代理</li>
<li>每个UIView内都有一个CALayer（即有个属性）</li>
</ol>
<h2 id="轮播图朴素实现的集中方法"><a href="#轮播图朴素实现的集中方法" class="headerlink" title="轮播图朴素实现的集中方法"></a>轮播图朴素实现的集中方法</h2><ol>
<li>UICollectionView, 简单粗暴放100个Cell</li>
<li>UIScrollView 首尾各放一个展示</li>
<li>UIScrollView 三个ImageView实现</li>
<li>UIImageView 自己实现layer转场动画</li>
</ol>
<h2 id="TableView-和-CollectionView-必选的代理方法"><a href="#TableView-和-CollectionView-必选的代理方法" class="headerlink" title="TableView 和 CollectionView 必选的代理方法"></a>TableView 和 CollectionView 必选的代理方法</h2><ul>
<li>delegate都是可选</li>
<li>datasource各有两个必选</li>
<li>table: cellForRowAtIndexPath、numberOfRowsInSection</li>
<li>collection: cellForItemAtIndexPath、numberOfItemsInSection</li>
</ul>
<h2 id="UITableView-的优化思路"><a href="#UITableView-的优化思路" class="headerlink" title="UITableView 的优化思路"></a>UITableView 的优化思路</h2><h4 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h4><ol>
<li>获取数据；</li>
<li>把数据转化成model、存进数组；</li>
<li>tableview调用reloadData刷新数据；</li>
<li>在代理方法cellForRowAtIndexPath里，创建自定义的cell，把model赋值给cell；</li>
<li>cell在对应的model的set方法里，根据拿到的model，设置图片的image，设置label的text等(控件都以懒加载形式初始化)；</li>
<li>在代理方法heightForRowAtIndexPath里，根据model，算出当前行应该显示多少的高度；</li>
<li>在cell的layoutSubviews方法里，布局子控件。</li>
</ol>
<h4 id="优化思路"><a href="#优化思路" class="headerlink" title="优化思路"></a>优化思路</h4><ol>
<li>避免主线程阻塞</li>
</ol>
<p>1/2步里的获取数据、数据处理等耗时操作，应该放入后台线程异步处理，处理好后再通知主线程刷新界面。</p>
<ol start="2">
<li>避免频繁的对象创建</li>
</ol>
<p>对象的创建会发送内存分配、属性调整等。<br>所以，首先，尽量用轻量的对象代替重量的对象。比如CALayer代替UIView。<br>接着，多利用缓存思想，对象创建后缓存起来，需要的时候再拿出来用。合理利用内存开销，减少CPU开销。<br>把 Cell setModel里的一些操作放在第二步数据转model里</p>
<ol start="3">
<li>减少对象的属性赋值操作</li>
</ol>
<p>尤其是UIView的frame/bounds等属性的赋值操作，会产生比较大的CPU消耗。<br>尽量少让Cell里空间动态变化，有规律的话筛分成多个固定cell</p>
<ol start="4">
<li>异步绘制</li>
</ol>
<p>文本渲染、图像绘制都是比较消耗性能的操作，而UILabel等控件都是在主线程进行的文本绘制。这会对性能产生比较大的影响。<br>UIKit和CoreAnimation相关操作必须在主线程中进行，其它的可以在后台线程异步执行</p>
<ol start="5">
<li>简化视图结构</li>
</ol>
<p>GPU在绘制图像前，会把重叠的视图进行混合，视图结构越复杂，这个操作就越耗时，如果存在透明视图，混合过程会更加复杂。所以，我们可以：</p>
<ul>
<li>尽量避免复杂的图层结构</li>
<li>少使用透明的视图</li>
<li>不透明的视图，设置opaque = YES </li>
</ul>
<ol start="6">
<li>减少离屏渲染</li>
</ol>
<p>老生常谈之圆角问题，圆角是开发中经常使用到的美化方式，但一般的设置cornerRadius时会配合masksToBounds属性，这就会造成离屏渲染。关于这种问题的处理，大致有两个思路：</p>
<ul>
<li>异步绘制一张圆角的图片来显示；</li>
<li>用一个圆角而中空的图来盖住。</li>
</ul>
<p>tableview需要刷新数据时，使用<br>[tableview beginUpdates]、[tableview insertRowsAtIndexPaths:indexArray withRowAnimation:UITableViewRowAnimationNone]、<br>[tableview endUpdates];而非<br>[tableview reloadData]从而刷新更少的行减少CPU压力</p>
<ol start="7">
<li>对于固定行高，前一个设置属性比后一个实现代理方法效率高</li>
</ol>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cell.tableview.rowHeight = <span class="number">50.0</span>;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">CGFloat</span>)tableView:(<span class="built_in">UITableView</span> *)tableView heightForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">50.0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="8">
<li><p>NSDateFormatter这个对象的相关操作很费时，需要避免频繁的创建和计算</p>
</li>
<li><p>利用RunLoop延时加载图片</p>
</li>
</ol>
<p>利用RunLoop：把图片加载的方法放在<code>NSDefaultRunLoopMode</code>里，这样当滑动时就切换出了这个Mode，暂停加载</p>

        </div>
        
          


  <section class="meta" id="footer-meta">
    <hr>
    <div class="new-meta-box">
      
        
          <div class="new-meta-item date" itemprop="dateUpdated" datetime="2019-08-01T18:15:29+08:00">
  <a class="notlink">
    <i class="fas fa-clock" aria-hidden="true"></i>
    <p>最后更新于 2019年8月1日</p>
  </a>
</div>

        
      
        
          
  
  <div class="new-meta-item meta-tags"><a class="tag" href="/tags/iOS/" rel="nofollow"><i class="fas fa-hashtag" aria-hidden="true"></i>&nbsp;<p>iOS</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/Objective-C/" rel="nofollow"><i class="fas fa-hashtag" aria-hidden="true"></i>&nbsp;<p>Objective-C</p></a></div>


        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
        <a class="-mob-share-qq" title="QQ好友" rel="external nofollow noopener noreferrer" href="http://connect.qq.com/widget/shareqq/index.html?url=https://paaatrick.com/2019-03-01-ios-interview-thing/&title=一些iOS面试基础题总结 | 派大星星星星&summary=一些iOS面试基础题总结">
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/qq.png">
          
        </a>
      
    
      
        <a class="-mob-share-qzone" title="QQ空间" rel="external nofollow noopener noreferrer" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://paaatrick.com/2019-03-01-ios-interview-thing/&title=一些iOS面试基础题总结 | 派大星星星星&summary=一些iOS面试基础题总结">
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/qzone.png">
          
        </a>
      
    
      
        <a class="qrcode" rel="external nofollow noopener noreferrer" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACtUlEQVR42u3awW7rIBAF0Pz/T/ttumilF3xnBtxUOqyiJAaOIxlyh9crbteb9iq2d1d9f/9atteJhoeHh7dp6u+GTCa0JiXXJqNHtwAPDw/vGC95WK+nm7RkwVj3n88ZDw8P73N4yWKwa9OcLBt4eHh4f4VXzQHyYCLfxOPh4eH9Li8JI3Jqcu28z81ZCx4eHt6BKtLnvD5S38PDw8MbV9WTYljvKED+fm+eX9fi4eHhHeBVt7N7b8GJQAQPDw/vSd4kMM2Xit4NyheM/8wZDw8P7wBvUo6aTLdaylr/ADfLBh4eHt4mXuJeH4RKBsvLVL2jBjcxBB4eHt5WXrWwlDys1wtA74BC9QfAw8PDO8ebDFN99PfCjklhDA8PD+9J3iSeKJSmioxyCQ0PDw/vMK9aDJtsf/PvJNRCjIuHh4e3idfbzvZi397xrOpN/7GlxsPDwzvA68Wv1U8nkUTz0BUeHh7eAV7OyLe/k0Ja9UhBYVw8PDy8Tbwrbvmkq9vlZAFo3iA8PDy8B3mTTnuR7nxpaYYReHh4eJ3iT+WrS+T6Qd/bQPeCDzw8PLwnecnA+dGoavCa3NBkbs3dOh4eHl7Aqwa1eZRQTVOrxwiirTkeHh7eAd76cT8JcPPFY1Iwi/rEw8PDe5zXiwbmEUN+hOvmLwEeHh7eMV4+3XyApM+9oxTqbHh4eHhjXrW0PylNJf3M8Xh4eHjP8JJAdh7m9gLiXlSBh4eHt5d3FVu+ad416dHxAjw8PLwDvGoJqheq5kWypIcNGDw8PLwxL18MkonmIUJeHssXhmYBDA8PD6/Fy8OF3hTPrVo3veHh4eF9AK8a1FbH6kUPzfoeHh4e3iO8fJubTz2JffNwedu6h4eHh7fk9S6ulspyQG/LjoeHh/cMr/eHfxI69NjVwwd4eHh4B3j/AD7nSt90o24fAAAAAElFTkSuQmCC">
        
          <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/wechat.png">
        
        </a>
      
    
      
        <a class="-mob-share-weibo" title="微博" rel="external nofollow noopener noreferrer" href="http://service.weibo.com/share/share.php?url=https://paaatrick.com/2019-03-01-ios-interview-thing/&title=一些iOS面试基础题总结 | 派大星星星星&summary=一些iOS面试基础题总结">
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/weibo.png">
          
        </a>
      
    
      
        <a class="qrcode" rel="external nofollow noopener noreferrer" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACtUlEQVR42u3awW7rIBAF0Pz/T/ttumilF3xnBtxUOqyiJAaOIxlyh9crbteb9iq2d1d9f/9atteJhoeHh7dp6u+GTCa0JiXXJqNHtwAPDw/vGC95WK+nm7RkwVj3n88ZDw8P73N4yWKwa9OcLBt4eHh4f4VXzQHyYCLfxOPh4eH9Li8JI3Jqcu28z81ZCx4eHt6BKtLnvD5S38PDw8MbV9WTYljvKED+fm+eX9fi4eHhHeBVt7N7b8GJQAQPDw/vSd4kMM2Xit4NyheM/8wZDw8P7wBvUo6aTLdaylr/ADfLBh4eHt4mXuJeH4RKBsvLVL2jBjcxBB4eHt5WXrWwlDys1wtA74BC9QfAw8PDO8ebDFN99PfCjklhDA8PD+9J3iSeKJSmioxyCQ0PDw/vMK9aDJtsf/PvJNRCjIuHh4e3idfbzvZi397xrOpN/7GlxsPDwzvA68Wv1U8nkUTz0BUeHh7eAV7OyLe/k0Ja9UhBYVw8PDy8Tbwrbvmkq9vlZAFo3iA8PDy8B3mTTnuR7nxpaYYReHh4eJ3iT+WrS+T6Qd/bQPeCDzw8PLwnecnA+dGoavCa3NBkbs3dOh4eHl7Aqwa1eZRQTVOrxwiirTkeHh7eAd76cT8JcPPFY1Iwi/rEw8PDe5zXiwbmEUN+hOvmLwEeHh7eMV4+3XyApM+9oxTqbHh4eHhjXrW0PylNJf3M8Xh4eHjP8JJAdh7m9gLiXlSBh4eHt5d3FVu+ad416dHxAjw8PLwDvGoJqheq5kWypIcNGDw8PLwxL18MkonmIUJeHssXhmYBDA8PD6/Fy8OF3hTPrVo3veHh4eF9AK8a1FbH6kUPzfoeHh4e3iO8fJubTz2JffNwedu6h4eHh7fk9S6ulspyQG/LjoeHh/cMr/eHfxI69NjVwwd4eHh4B3j/AD7nSt90o24fAAAAAElFTkSuQmCC">
        
          <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/qrcode.png">
        
        </a>
      
    
  </div>
</div>



        
      
    </div>
  </section>


        
        
            <div class="prev-next">
                
                    <section class="prev">
                        <span class="art-item-left">
                            <h6><i class="fas fa-chevron-left" aria-hidden="true"></i>&nbsp;上一页</h6>
                            <h4>
                                <a href="/2019-03-05-iphone-pixel-point-size-scale/" rel="prev" title="iPhone屏幕各种尺寸分辨率（更新至XS）">
                                  
                                      iPhone屏幕各种尺寸分辨率（更新至XS）
                                  
                                </a>
                            </h4>
                            
                                
                                <h6 class="tags">
                                    <a class="tag" href="/tags/iOS/"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>iOS</a> <a class="tag" href="/tags/Objective-C/"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>Objective-C</a>
                                </h6>
                            
                        </span>
                    </section>
                
                
                    <section class="next">
                        <span class="art-item-right" aria-hidden="true">
                            <h6>下一页&nbsp;<i class="fas fa-chevron-right" aria-hidden="true"></i></h6>
                            <h4>
                                <a href="/2019-02-23-ios-block-and-mainqueue/" rel="prev" title="iOS处理多线程异步Block中的UI操作">
                                    
                                        iOS处理多线程异步Block中的UI操作
                                    
                                </a>
                            </h4>
                            
                                
                                <h6 class="tags">
                                    <a class="tag" href="/tags/iOS/"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>iOS</a> <a class="tag" href="/tags/Objective-C/"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>Objective-C</a>
                                </h6>
                            
                        </span>
                    </section>
                
            </div>
        
      </section>
    </article>
  

  
    <!-- 显示推荐文章和评论 -->



  <article class="post white-box comments">
    <section class="article typo">
      <h4><i class="fas fa-comments fa-fw" aria-hidden="true"></i>&nbsp;评论</h4>
      
        <section id="comments">
          <div id="disqus_thread">
            <div><i class="fas fa-exclamation-triangle">&nbsp;无法加载Disqus评论系统，请确保您的网络能够正常访问。</i></div>
          </div>
        </section>
      
      
      
      
    </section>
  </article>


  




<!-- 根据页面mathjax变量决定是否加载MathJax数学公式js -->



  <script>
    window.subData = {
      title: '一些iOS面试基础题总结',
      tools: true
    }
  </script>


</div>
<aside class="l_side">
  
    
    
      
        
          
          
            <section class="widget author">
  <div class="content pure">
    
      <div class="avatar">
        <img class="avatar" src="https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190516125601.jpg">
      </div>
    
    
    
      <div class="social-wrapper">
        
          
            <a href="https://github.com/Fongim" class="social fab fa-github flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="mailto:me@paaatrick.com" class="social fas fa-envelope flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="https://me.csdn.net/fongim" class="social fab fa-contao flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
            </a>
          
        
      </div>
    
  </div>
</section>

          
        
      
        
          
          
            
  <section class="widget toc-wrapper">
    
<header class="pure">
  <div><i class="fas fa-list fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;本文目录</div>
  
    <div class="wrapper"><a class="s-toc rightBtn" rel="external nofollow noopener noreferrer" href="javascript:void(0)"><i class="fas fa-thumbtack fa-fw"></i></a></div>
  
</header>

    <div class="content pure">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#目录"><span class="toc-text">目录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#多线程"><span class="toc-text">多线程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#线程之间同步"><span class="toc-text">线程之间同步</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#多线程之间通信"><span class="toc-text">多线程之间通信</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#如何保证线程安全"><span class="toc-text">如何保证线程安全</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#多线程的坑"><span class="toc-text">多线程的坑</span></a></li></ol></li></ol><li class="toc-item toc-level-2"><a class="toc-link" href="#AutoLayout"><span class="toc-text">AutoLayout</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#objc-msgSend"><span class="toc-text">objc_msgSend</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Runtime"><span class="toc-text">Runtime</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Method-Swizzling"><span class="toc-text">Method Swizzling</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#几个常见方法"><span class="toc-text">几个常见方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Swizzling-模板"><span class="toc-text">Swizzling 模板</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#消息转发"><span class="toc-text">消息转发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Category"><span class="toc-text">Category</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSObject-与-objc-class"><span class="toc-text">NSObject 与 objc_class</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Runloop"><span class="toc-text">Runloop</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#介绍"><span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#结构"><span class="toc-text">结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Timer"><span class="toc-text">Timer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Source"><span class="toc-text">Source</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Observer"><span class="toc-text">Observer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CFRunLoopMode"><span class="toc-text">CFRunLoopMode</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RunLoop-与-GCD-的关系"><span class="toc-text">RunLoop 与 GCD 的关系</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RunLoop-的挂起与唤醒"><span class="toc-text">RunLoop 的挂起与唤醒</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#作用"><span class="toc-text">作用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#过程"><span class="toc-text">过程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AFNetworking的RunLoop用法"><span class="toc-text">AFNetworking的RunLoop用法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#利用RunLoop延时加载图片"><span class="toc-text">利用RunLoop延时加载图片</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Crash时重启RunLoop"><span class="toc-text">Crash时重启RunLoop</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#监测卡顿的方法"><span class="toc-text">监测卡顿的方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AutoreleasePool"><span class="toc-text">AutoreleasePool</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#iOS系统架构"><span class="toc-text">iOS系统架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#App启动过程与优化"><span class="toc-text">App启动过程与优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UIScrollView-的代理方法"><span class="toc-text">UIScrollView 的代理方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#响应链和事件传递"><span class="toc-text">响应链和事件传递</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UIView-和-CALayer-的区别和联系"><span class="toc-text">UIView 和 CALayer 的区别和联系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#轮播图朴素实现的集中方法"><span class="toc-text">轮播图朴素实现的集中方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TableView-和-CollectionView-必选的代理方法"><span class="toc-text">TableView 和 CollectionView 必选的代理方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UITableView-的优化思路"><span class="toc-text">UITableView 的优化思路</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#流程"><span class="toc-text">流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#优化思路"><span class="toc-text">优化思路</span></a></li></ol></li>
    </div>
  </section>


          
        
      
        
          
          
            
  <section class="widget category">
    
<header class="pure">
  <div><i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;文章分类</div>
  
    <a class="rightBtn" rel="nofollow" href="/categories/" title="categories/">
    <i class="fas fa-expand-arrows-alt fa-fw"></i></a>
  
</header>

    <div class="content pure">
      <ul class="entry">
        
          <li><a class="flat-box" title="/categories/Algorithm/" href="/categories/Algorithm/"><div class="name">Algorithm</div><div class="badge">(10)</div></a></li>
        
          <li><a class="flat-box" title="/categories/Life/" href="/categories/Life/"><div class="name">Life</div><div class="badge">(4)</div></a></li>
        
          <li><a class="flat-box" title="/categories/Note/" href="/categories/Note/"><div class="name">Note</div><div class="badge">(12)</div></a></li>
        
          <li><a class="flat-box" title="/categories/Tech/" href="/categories/Tech/"><div class="name">Tech</div><div class="badge">(11)</div></a></li>
        
      </ul>
    </div>
  </section>


          
        
      
        
          
          
            
  <section class="widget tagcloud">
    
<header class="pure">
  <div><i class="fas fa-fire fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;热门标签</div>
  
    <a class="rightBtn" rel="nofollow" href="/tags/" title="tags/">
    <i class="fas fa-expand-arrows-alt fa-fw"></i></a>
  
</header>

    <div class="content pure">
      <a href="/tags/Algorithm/" style="font-size: 20px; color: #707070">Algorithm</a> <a href="/tags/Food/" style="font-size: 16px; color: #8b8b8b">Food</a> <a href="/tags/Hotel/" style="font-size: 14px; color: #999">Hotel</a> <a href="/tags/LeetCode/" style="font-size: 20px; color: #707070">LeetCode</a> <a href="/tags/NetworkProtocol/" style="font-size: 18px; color: #7e7e7e">NetworkProtocol</a> <a href="/tags/Objective-C/" style="font-size: 22px; color: #636363">Objective-C</a> <a href="/tags/Python/" style="font-size: 20px; color: #707070">Python</a> <a href="/tags/WordPress/" style="font-size: 16px; color: #8b8b8b">WordPress</a> <a href="/tags/iOS/" style="font-size: 24px; color: #555">iOS</a>
    </div>
  </section>


          
        
      
    

  
</aside>

<footer id="footer" class="clearfix">
  
  
    <div class="social-wrapper">
      
        
          <a href="https://github.com/Fongim" class="social fab fa-github flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="mailto:me@paaatrick.com" class="social fas fa-envelope flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="https://me.csdn.net/fongim" class="social fab fa-contao flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
          </a>
        
      
    </div>
  
  <br>
  <div><p>©2019 派大星星星星</p>
</div>
  <div>
    本站使用
    <a href="https://xaoxuu.com/wiki/material-x/" target="_blank" class="codename">Material X</a>
    作为主题
    
      ，
      总访问量为
      <span id="busuanzi_value_site_pv"><i class="fas fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span>
      次
    
    。
  </div>
</footer>
<script>setLoadingBarProgress(80);</script>


      <script>setLoadingBarProgress(60);</script>
    </div>
    <a class="s-top fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>

  <script>
    var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
    var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
    var ALGOLIA_API_KEY = "";
    var ALGOLIA_APP_ID = "";
    var ALGOLIA_INDEX_NAME = "";
    var AZURE_SERVICE_NAME = "";
    var AZURE_INDEX_NAME = "";
    var AZURE_QUERY_KEY = "";
    var BAIDU_API_ID = "";
    var SEARCH_SERVICE = "hexo" || "hexo";
    var ROOT = "/"||"/";
    if(!ROOT.endsWith('/'))ROOT += '/';
  </script>

<script src="//instant.page/1.2.2" type="module" integrity="sha384-2xV8M5griQmzyiY3CDqh1dn4z3llDVqZDqzjzcY+jCBCk/a5fXJmuZ/40JJAPeoU"></script>


  <script async src="https://cdn.jsdelivr.net/npm/scrollreveal@4.0.5/dist/scrollreveal.min.js"></script>
  <script type="text/javascript">
    $(function() {
      const $reveal = $('.reveal');
      if ($reveal.length === 0) return;
      const sr = ScrollReveal({ distance: 0 });
      sr.reveal('.reveal');
    });
  </script>


  <script src="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.js"></script>
  <script type="text/javascript">
    $(function() {
      Waves.attach('.flat-btn', ['waves-button']);
      Waves.attach('.float-btn', ['waves-button', 'waves-float']);
      Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
      Waves.attach('.flat-box', ['waves-block']);
      Waves.attach('.float-box', ['waves-block', 'waves-float']);
      Waves.attach('.waves-image');
      Waves.init();
    });
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js"></script>




  
  
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script>
    <script type="text/javascript">
      $(function(){
        const images = ["https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190516120523.jpeg", "https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190516120522.jpeg", "https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190516120521.jpeg", "https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190516120520.jpeg", "https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190516120519.jpeg", "https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190516120518.jpeg", "https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190516120517.jpeg", "https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190516120516.jpeg", "https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190516120515.jpeg"];
        for (let i = 1; i < images.length; i++) {
          const random = Math.floor(Math.random() * (i + 1));
          [images[i], images[random]] = [images[random], images[i]];
        }
        if ('') {
          $('').backstretch(images, 
          {
            duration: "40000",
            fade: "2500"
          });
        } else {
          $.backstretch(images, 
          {
            duration: "40000",
            fade: "2500"
          });
        }
      });
    </script>
  





  <script>
    var disqus_shortname = 'paaatrick-com';
    
      var disqus_url = 'https://paaatrick.com/2019-03-01-ios-interview-thing/';
    
    (function(){
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>







  <script src="/js/app.js"></script>


  <script src="/js/search.js"></script>




<!-- 复制 -->
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  let COPY_SUCCESS = "复制成功";
  let COPY_FAILURE = "复制失败";
  /*页面载入完成后，创建复制按钮*/
  !function (e, t, a) {
    /* code */
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '  <i class="fa fa-copy"></i><span>复制</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });

      clipboard.on('success', function(e) {
        //您可以加入成功提示
        console.info('Action:', e.action);
        console.info('Text:', e.text);
        console.info('Trigger:', e.trigger);
        success_prompt(COPY_SUCCESS);
        e.clearSelection();
      });
      clipboard.on('error', function(e) {
        //您可以加入失败提示
        console.error('Action:', e.action);
        console.error('Trigger:', e.trigger);
        fail_prompt(COPY_FAILURE);
      });
    }
    initCopyCode();

  }(window, document);

  /**
   * 弹出式提示框，默认1.5秒自动消失
   * @param message 提示信息
   * @param style 提示样式，有alert-success、alert-danger、alert-warning、alert-info
   * @param time 消失时间
   */
  var prompt = function (message, style, time)
  {
      style = (style === undefined) ? 'alert-success' : style;
      time = (time === undefined) ? 1500 : time*1000;
      $('<div>')
          .appendTo('body')
          .addClass('alert ' + style)
          .html(message)
          .show()
          .delay(time)
          .fadeOut();
  };

  // 成功提示
  var success_prompt = function(message, time)
  {
      prompt(message, 'alert-success', time);
  };

  // 失败提示
  var fail_prompt = function(message, time)
  {
      prompt(message, 'alert-danger', time);
  };

  // 提醒
  var warning_prompt = function(message, time)
  {
      prompt(message, 'alert-warning', time);
  };

  // 信息提示
  var info_prompt = function(message, time)
  {
      prompt(message, 'alert-info', time);
  };

</script>


<!-- fancybox -->
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script>
  let LAZY_LOAD_IMAGE = "";
  $(".article-entry").find("fancybox").find("img").each(function () {
      var element = document.createElement("a");
      $(element).attr("data-fancybox", "gallery");
      $(element).attr("href", $(this).attr("src"));
      /* 图片采用懒加载处理时,
       * 一般图片标签内会有个属性名来存放图片的真实地址，比如 data-original,
       * 那么此处将原本的属性名src替换为对应属性名data-original,
       * 修改如下
       */
       if (LAZY_LOAD_IMAGE) {
         $(element).attr("href", $(this).attr("data-original"));
       }
      $(this).wrap(element);
  });
</script>





  <script>setLoadingBarProgress(100);</script>
</body>
</html>
