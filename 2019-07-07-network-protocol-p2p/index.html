<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  <title>杂谈网络协议之种子与P2P | 派大星星星星</title>
  
  <meta name="keywords" content="iOS">
  
  

  

  <meta name="HandheldFriendly" content="True">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <!-- meta -->
  

  <!-- link -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.css">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.6.3/css/all.min.css">
  

  
  <link rel="shortcut icon" type="image/x-icon" href="https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/fat_cat_header_small.png">
  

  
    <link rel="stylesheet" href="/style.css">
  

  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>

  
  
    <!-- ba -->
    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?420331e790ec3f2c56b1660b4958f8c3";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
    </script>
  
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5105307489041516" crossorigin="anonymous"></script>
</head>

<body>
  
  
  <div class="cover-wrapper">
    <cover class='cover post half'>
      
        
  <img class='logo' src='https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/fat_cat_header_small.png'/>


  <div class="m_search">
    <form name="searchform" class="form u-search-form">
      <input type="text" class="input u-search-input" placeholder="" />
      <i class="icon fas fa-search fa-fw"></i>
    </form>
  </div>

<div class='menu navgation'>
  <ul class='h-list'>
    
      
        <li>
          <a class="nav home" href="/"
            
            
            id="home">
            <i class='fas fa-beer fa-fw'></i>&nbsp;博客
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/categories/"
            
            
            id="categories">
            <i class='fas fa-folder-open fa-fw'></i>&nbsp;分类
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/tags/"
            
            
            id="tags">
            <i class='fas fa-tags fa-fw'></i>&nbsp;标签
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/archives/"
            
            
            id="archives">
            <i class='fas fa-archive fa-fw'></i>&nbsp;归档
          </a>
        </li>
      
    
  </ul>
</div>

      
    </cover>
    <header class="l_header pure">
  <div id="loading-bar-wrapper">
    <div id="loading-bar" class="pure"></div>
  </div>

	<div class='wrapper'>
		<div class="nav-main container container--flex">
      <a class="logo flat-box" href='/' >
        
          派大星星星星
        
      </a>
			<div class='menu navgation'>
				<ul class='h-list'>
          
  					
  						<li>
								<a class="nav flat-box" href="/"
                  
                  
                  id="home">
									<i class='fas fa-beer fa-fw'></i>&nbsp;博客
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/categories/"
                  
                  
                  id="categories">
									<i class='fas fa-folder-open fa-fw'></i>&nbsp;分类
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/tags/"
                  
                  
                  id="tags">
									<i class='fas fa-tags fa-fw'></i>&nbsp;标签
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/archives/"
                  
                  
                  id="archives">
									<i class='fas fa-archive fa-fw'></i>&nbsp;归档
								</a>
							</li>
      			
      		
				</ul>
			</div>

			
				<div class="m_search">
					<form name="searchform" class="form u-search-form">
						<input type="text" class="input u-search-input" placeholder="搜索" />
						<i class="icon fas fa-search fa-fw"></i>
					</form>
				</div>
			
			<ul class='switcher h-list'>
				
					<li class='s-search'><a class="fas fa-search fa-fw" href='javascript:void(0)'></a></li>
				
				<li class='s-menu'><a class="fas fa-bars fa-fw" href='javascript:void(0)'></a></li>
			</ul>
		</div>

		<div class='nav-sub container container--flex'>
			<a class="logo flat-box"></a>
			<ul class='switcher h-list'>
				<li class='s-comment'><a class="flat-btn fas fa-comments fa-fw" href='javascript:void(0)'></a></li>
        
          <li class='s-toc'><a class="flat-btn fas fa-list fa-fw" href='javascript:void(0)'></a></li>
        
			</ul>
		</div>
	</div>
</header>
	<aside class="menu-phone">
    <header>
		<nav class="menu navgation">
      <ul>
        
          
            <li>
							<a class="nav flat-box" href="/"
                
                
                id="home">
								<i class='fas fa-beer fa-fw'></i>&nbsp;博客
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/categories/"
                
                
                id="categories">
								<i class='fas fa-folder-open fa-fw'></i>&nbsp;分类
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/tags/"
                
                
                id="tags">
								<i class='fas fa-tags fa-fw'></i>&nbsp;标签
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/archives/"
                
                
                id="archives">
								<i class='fas fa-archive fa-fw'></i>&nbsp;归档
							</a>
            </li>
          
       
      </ul>
		</nav>
    </header>
	</aside>
<script>setLoadingBarProgress(40);</script>

  </div>


  <div class="l_body">
    <div class='body-wrapper'>
      <div class='l_main'>
  

  
    <article id="post" class="post white-box article-type-post" itemscope itemprop="blogPost">
      


  <section class='meta'>
    
    
    <div class="meta" id="header-meta">
      
        
  
    <h1 class="title">
      <a href="/2019-07-07-network-protocol-p2p/">
        杂谈网络协议之种子与P2P
      </a>
    </h1>
  


      
      <div class='new-meta-box'>
        
          
        
          
            
  <div class='new-meta-item author'>
    <a href="https://paaatrick.com" rel="nofollow">
      
        <i class="fas fa-user" aria-hidden="true"></i>
      
      <p>大星</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2019-07-07</p>
  </a>
</div>

          
        
          
            
  
  <div class='new-meta-item category'>
    <a href='/categories/Tech/' rel="nofollow">
      <i class="fas fa-folder-open" aria-hidden="true"></i>
      <p>Tech</p>
    </a>
  </div>


          
        
          
            
  
    <div class="new-meta-item browse busuanzi">
      <a class='notlink'>
        <i class="fas fa-eye" aria-hidden="true"></i>
        <p>
          <span id="busuanzi_value_page_pv">
            <i class="fas fa-spinner fa-spin fa-fw" aria-hidden="true"></i>
          </span>
        </p>
      </a>
    </div>
  


          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


      <section class="article typo">
        <div class="article-entry" itemprop="articleBody">
          <p>最近学了些P2P协议相关的内容，做了些笔记。</p>
<a id="more"></a>

<h2 id="P2P"><a href="#P2P" class="headerlink" title="P2P"></a>P2P</h2><p>P2P 即 peer-to-peer，为了解决 HTTP 或 FTP 下载文件时难以解决单一服务器带宽压力的缺点。P2P 的特点是资源开始并不集中地存储在某些设备上，而是分散地存储在多台设备上，而是分散地存储在多台设备上。这些设备我们姑且称为 peer。</p>
<p>想要下载一个文件的时候，只需得到那些已经存在了文件的 peer，并和这些 peer 之间，建立点对点的连接，而不需要到中心服务器上，就可以就近下载文件。一旦下载了文件，你也就成为 peer 中的一员，你旁边的那些机器，也可能会选择从你这里下载文件，所以当你使用 P2P 软件的时候，例如 BitTorrent，往往能够看到，既有下载流量，也有上传的流量，也即你自己也加入了这个 P2P 的网络，自己从别人那里下载，同时也提供给其他人下载。</p>
<p><img src="https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190708180237.png" alt></p>
<p>美国工程师 Bram Cohen 在 2001 年发布了 BitTorrent 协议，资源不再由一个人或一个中心服务器提供，而是所有人提供给所有人，下载的人越多，速度越快。</p>
<p>BitTorrent 的核心思想是把文件分成很多个小块，让下载者互相连接。协议需要资源共享者生成一个包含下载信息的种子文件，后缀是 .torrent，即 BT 种子。</p>
<h2 id="torrent"><a href="#torrent" class="headerlink" title="torrent"></a>torrent</h2><p>.torrent 种子文件由两部分组成，分别是：announce（tracker URL）和文件信息</p>
<p>文件信息包含文件的名字、大小，分块后每块文件的大小、哈希值等，具体如下：</p>
<ul>
<li>info 区：指定的是种子文件数量、文件大小、目录结构、目录和文件的名字</li>
<li>Name 字段：指定顶层目录名字。</li>
<li>每个段的大小：BitTorrent 协议把文件分成很多个小段</li>
<li>段哈希值：整个种子中，每个段的 SHA-1 哈希值拼在一起</li>
</ul>
<p>下载时，BT 客户端首先解析.torrent 文件，得到 Tracker 地址，然后连接 Tracker 服务器。</p>
<p>Tracker 很重要，通过 Tracker 我们才能找到其他下载者的联系方式。当你用下载软件打开种子，就会开始联系种子文件里内置的 Tracker 服务器，告诉 Tracker 我要下载这个文件，服务器会记录下你的 IP，并把其他正在下载或下载完成的人的 IP 返回给你，这样你们就可以愉快的组队下载了。</p>
<p>Tracker 服务器回应下载者请求，将其他下载者包括发布者的 IP 提供给下载者。下载者再连接其他下载者，根据种子文件，双方互相告知自己已经有的块，然后交换对方没有的数据。此时不需要其他服务器参与，并分散了单个线路上的数据流量，减轻服务器负担。</p>
<p>下载者每得到一个块，需要算出下载块的 Hash 验证码，并与.torrent 文件中的对比。如果一样，则说明块正确，不一样则需要重新下载这个块。这种规定是为了解决下载内容的准确性问题。</p>
<p>当然，如果没有找到正在下载的人，资源发布者也不在线，你就只能以 0kb/s 的速度等着了。</p>
<p>不难发现，Tracker 服务器是 P2P 网络的弱点，如果 Tracker 被关闭或封禁，你就无法找到同伴，也难以完成下载，BT 依然是中心化的协议。</p>
<p><img src="https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190708180236.png" alt></p>
<h2 id="DHT-去中心化网络"><a href="#DHT-去中心化网络" class="headerlink" title="DHT 去中心化网络"></a>DHT 去中心化网络</h2><p>为了摆脱对 Tracker 服务器的依赖，彻底去中心化，于是产生了一种叫做 DHT（Distributed Hash Table）的去中心化网络，每个加入 DHT 网络的人，都要负责存储这个网络里的资源信息和其他成员的联系信息，相当于所有人一起构成了一个庞大的分布式存储数据库。</p>
<p><img src="https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190708180234.png" alt></p>
<p>DHT 的本质是把所有人都变成一个小型 Tracker，每个人都拿着一份动态更新的地址和文件信息。我找与我连接的 10 个人，他们再各自找 10 个人，一传十十传百、千、万，最后我通过N个人的中转，找到应该连上的人。</p>
<p>有一种著名的 DHT 协议：Kademlia。任何一个 BitTorrent 启动之后，它都有两个角色。一个是 peer，监听一个 TCP 端口，用来上传和下载文件，这个角色表明，我这里有某个文件。另一个角色 DHT node，监听一个 UDP 的端口，通过这个角色，这个节点加入了一个 DHT 的网络。</p>
<p><img src="https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190708181046.jpg" alt></p>
<p>在 DHT 网络中，每个 DHT node 都有一个很长的 ID 字符串。每个 DHT node 都有责任掌握一些知识，即文件索引，即它应该知道某些文件是保存在哪些节点上。它只需要有这些知识就行，自己本身不一定就是保存这个文件的节点。node 应该知道哪些知识是通过哈希算法计算出来。</p>
<p>每个文件都有一串通过 SHA1 哈希算法计算出唯一的文件 ID，可以产生 2 的 (4*40) 即 2 的 160 次方种组合，用只有 0 和 1 的二进制表示就是 160 个 0 和 1。</p>
<p>而每个节点也有一串 160 位的 0 和 1，作为节点 ID。根据这 160 位数，我们可以计算节点和节点之间，节点和资源之间的距离。</p>
<p>在 Kademlia 网络中，距离是通过异或（XOR）计算的。以5位举例，01010 与 01000 的距离，就是两个 ID 之间的异或值，为 00010，也即为 2。 01010 与 00010 的距离为 01000，也即为 8。01010 与 00011 的距离为 01001，也即 8+1=9。以此类推，高位不同的，表示距离更远一些；低位不同的，表示距离更近一些，总的距离为所有的不同的位的距离之和。</p>
<p>有个理论是，社交网络中，任何两个人直接的距离不超过六度，也即你想联系比尔盖茨，也就六个人就能够联系到了。</p>
<p>假设小明发布了一个文件，就能计算他所知道的节点 ID 与这个文件 ID 的距离，让算出来最距离最短的节点再计算它知道的节点和文件 ID 的距离，重复这个过程，就能找到与文件 ID 的距离最短的一批节点 ID，把小明提供的下载信息存在这里。</p>
<p>这样，下载者也只要找到和文件 ID 距离接近的节点 ID，就能建立连接，开始下载。</p>
<h4 id="DHT-网络如何维护"><a href="#DHT-网络如何维护" class="headerlink" title="DHT 网络如何维护"></a>DHT 网络如何维护</h4><p>就像人一样，虽然我们常联系人的只有少数，但是朋友圈里肯定是远近都有。DHT 网络的朋友圈也是一样，远近都有，并且按距离分层。</p>
<p>假设某个节点的 ID 为 01010，如果一个节点的 ID，前面所有位数都与它相同，只有最后 1 位不同。这样的节点只有 1 个，为 01011。与基础节点的异或值为 00001，即距离为 1；对于 01010 而言，这样的节点归为“k-bucket 1”。</p>
<p>如果一个节点的 ID，前面所有位数都相同，从倒数第 2 位开始不同，这样的节点只有 2 个，即 01000 和 01001，与基础节点的异或值为 00010 和 00011，即距离范围为 2 和 3；对于 01010 而言，这样的节点归为“k-bucket 2”。</p>
<p>如果一个节点的 ID，前面所有位数相同，从倒数第 i 位开始不同，这样的节点只有 2^(i-1) 个，与基础节点的距离范围为 [2^(i-1), 2^i)；对于 01010 而言，这样的节点归为“k-bucket i”。</p>
<p>最终到从倒数 160 位就开始都不同。差距越大，陌生人越多，但是朋友圈不能都放下，所以每一层都只放 K 个，这是参数可以配置。</p>
<h4 id="DHT-网络节点的查找"><a href="#DHT-网络节点的查找" class="headerlink" title="DHT 网络节点的查找"></a>DHT 网络节点的查找</h4><p>假设，node A 的 ID 为 00110，要找 node B ID 为 10000，异或距离为 10110，距离范围在 [2^4, 2^5)，所以这个目标节点可能在“k-bucket 5”中，这就说明 B 的 ID 与 A 的 ID 从第 5 位开始不同，所以 B 可能在“k-bucket 5”中。</p>
<p>然后，A 看看自己的 k-bucket 5 有没有 B。如果有就找到了；如果没有，在 k-bucket 5 里随便找一个 C。因为是二进制，C、B 都和 A 的第 5 位不同，那么 C 的 ID 第 5 位肯定与 B 相同，即它与 B 的距离会小于 2^4，相当于比A、B 之间的距离缩短了一半以上。</p>
<p>再请求 C，在它自己的通讯录里，按同样的查找方式找一下 B。如果 C 知道 B，就告诉 A；如果 C 也不知道 B，那 C 按同样的搜索方法，可以在自己的通讯录里找到一个离 B 更近的 D 朋友（D、B 之间距离小于 2^3），把 D 推荐给 A，A 请求 D 进行下一步查找。</p>
<p>Kademlia 的这种查询机制，是通过折半查找的方式来收缩范围，对于总的节点数目为 N，最多只需要查询 log2(N) 次，就能够找到。</p>
<h4 id="DHT-网络节点之间的沟通"><a href="#DHT-网络节点之间的沟通" class="headerlink" title="DHT 网络节点之间的沟通"></a>DHT 网络节点之间的沟通</h4><p>Kademlia 算法中，每个节点只有 4 个指令。</p>
<ul>
<li>PING：测试一个节点是否在线。</li>
<li>STORE：要求一个节点存储一份数据。</li>
<li>FIND_NODE：根据节点 ID 查找一个节点</li>
<li>FIND_VALUE：根据 KEY 查找一个数据，与 FIND_NODE 类似</li>
</ul>
<h4 id="DHT-网络的更新"><a href="#DHT-网络的更新" class="headerlink" title="DHT 网络的更新"></a>DHT 网络的更新</h4><p>每个 bucket 里的节点，都按最后一次接触的时间倒序排列，这就相当于，朋友圈里面最近联系过的人往往是最熟的。</p>
<p>每次执行四个指令中的任意一个都会触发更新。</p>
<p>当一个节点与自己接触时，检查它是否已经在 k-bucket 中，也就是说是否已经在朋友圈。如果在，那么将它挪到 k-bucket 列表的最底，也就是最新的位置，刚联系过，就置顶一下，方便以后多联系；如果不在，新的联系人要不要加到通讯录里面呢？假设通讯录已满的情况，PING 一下列表最上面，也即最旧的一个节点。如果 PING 通了，将旧节点挪到列表最底，并丢弃新节点，老朋友还是留一下；如果 PING 不通，删除旧节点，并将新节点加入列表，这人联系不上了，删了吧。</p>
<p>这个机制保证了任意节点加入和离开都不影响整体网络。</p>
<h2 id="磁力链接"><a href="#磁力链接" class="headerlink" title="磁力链接"></a>磁力链接</h2><p>今天最流行的下载方式是磁力链接（Magnet URI scheme）就是基于 DHT 网络的，通常是一串这样的神秘代码：</p>
<p><img src="https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190708180235.png" alt></p>
<p>前面都是标准格式，最重要的是这 40 个 16 进制的数字即 160 位 2 进制数字。任何文件丢进 SHA1 哈希算法都能得到一串这样字符，40 位、16 进制、只属于这个文件，它能帮我们找到我们要下载的东西。</p>
<p>根据上面讲的 DHT，只需要一串文件 ID 和存储在本地的 K 桶数据，你就可以高效的找到要下载的文件。而资源的发布者和传播者也只需要分享 40 个数字就好，足够简单，方便和隐私。</p>
<p>在真实的 DHT 网络，每个 K 桶至少记录了 8 个节点，任何一个节点下线，都不会影响整个网络的运行。</p>
<p>作为文件和节点 ID ，2 的 160 次方也足够大，大到全地球 70 亿人每秒下载 10000 个种子，也足够下载百万亿年直到宇宙终结。</p>
<p>这些天才们的设计，让我们拥有了一个无法被审查和追踪的去中心化网络。这催生了庞大的盗版产业，但也让很多内容有机会避开审查。</p>
<p>因为网站可以被隔离、被拔线、被禁止访问，但种子不会。只要种子不死，那些不存在的音乐图书和视频就还活在互联网上，没有任何人可以毁掉。</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><ul>
<li><p>下载一个文件可以使用 HTTP 或 FTP，这两种都是集中下的方式，而 P2P 则换了一种思路，采取非中心化下载的方式；</p>
</li>
<li><p>P2P 也是有两种，一种是依赖于 tracker 的，也即元数据集中，文件数据分散；另一种是基于分布式的哈希算法，元数据和文件数据全部分散。</p>
</li>
</ul>

        </div>
        
          


  <section class='meta' id="footer-meta">
    <hr>
    <div class='new-meta-box'>
      
        
          <div class="new-meta-item date" itemprop="dateUpdated" datetime="2021-11-07T20:02:15+08:00">
  <a class='notlink'>
    <i class="fas fa-clock" aria-hidden="true"></i>
    <p>最后更新于 2021年11月7日</p>
  </a>
</div>

        
      
        
          
  
  <div class="new-meta-item meta-tags"><a class="tag" href="/tags/NetworkProtocol/" rel="nofollow"><i class="fas fa-hashtag" aria-hidden="true"></i>&nbsp;<p>NetworkProtocol</p></a></div>


        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
        <a class="-mob-share-qq" title="QQ好友" rel="external nofollow noopener noreferrer"
          
          href="http://connect.qq.com/widget/shareqq/index.html?url=https://paaatrick.com/2019-07-07-network-protocol-p2p/&title=杂谈网络协议之种子与P2P | 派大星星星星&summary=最近学了些P2P协议相关的内容，做了些笔记。"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/qq.png">
          
        </a>
      
    
      
        <a class="-mob-share-qzone" title="QQ空间" rel="external nofollow noopener noreferrer"
          
          href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://paaatrick.com/2019-07-07-network-protocol-p2p/&title=杂谈网络协议之种子与P2P | 派大星星星星&summary=最近学了些P2P协议相关的内容，做了些笔记。"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/qzone.png">
          
        </a>
      
    
      
        <a class='qrcode' rel="external nofollow noopener noreferrer" href='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACtUlEQVR42u3aQU7EMAwF0Ln/pYct0tDybceoQq+r0QCpXxaJsf16xc/72/P5zef3V5+TdZLVDj94eHh4g9CTIJIVkg26D/r+N5OY8fDw8LZ59y+4p96H3tumPJ5fLHh4eHgP4CUJbp4650Hj4eHh/Q9efnmcKn/g4eHhPYdXPbLnh3svQV+steDh4eHFvPyYfs7nlf4eHh4e3rirfn/g9o7jPH3Pr4HLaPHw8PAWePmBmzMmZYt8GKsQJx4eHt4yLzmg86ZUXopN/rZZOsHDw8Nb4yVl017SPLkY8lLvZYR4eHh4a7xqIpukuXlCXB0LKPf38PDw8BZ41UALY0+t4I519vDw8PCO8nol1PyneUMr2fR8ncv+Hh4eHt4h3vyMTYoRk4GqalL+qt4neHh4eId4+ehV3rKat7gKZWI8PDy8BV6vkFodGqiWaOc/xcPDw/tLXu+Y7l0w1aJG9SrCw8PD2+DNS6hnN6JajPhlTTw8PLw13ql2Vz4EkKfsyXZc/j4eHh7eGi/5Jz9PuHuN/0JZIb/S8PDw8BZ4CSY/7vMCbvW4711ReHh4eBu8PNnNX9kb2+qVdMs9PTw8PLwxr5cuJ+lvr/BafWNUwsDDw8Nb4BX+pY8XrabCvfS6l6zj4eHhzXkbh3VeqM3DbdZa8PDw8JZ589fn7bQk+c4LzfXJAjw8PLwpr9rOT8LKN+7U9VOuVePh4eENeEmg1bJpvk3ltla1y4eHh4d3iPcuPtVRgB6sNzX2wxvx8PDwFnjVAzfH9xpXvUZXGYOHh4c35iVBJwd9b8184/KLCg8PD+9veL2mV7LCgXspLkDg4eHhPZN3KinvJdnl9BoPDw/vMbxeGaI6ejUpheDh4eFt8/JCQDJAUB01yMOtFinw8PDwNni9Wa18I/JN7F0wh+sZeHh4eHfPF4/9St/jqjv7AAAAAElFTkSuQmCC'>
        
          <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/wechat.png">
        
        </a>
      
    
      
        <a class="-mob-share-weibo" title="微博" rel="external nofollow noopener noreferrer"
          
          href="http://service.weibo.com/share/share.php?url=https://paaatrick.com/2019-07-07-network-protocol-p2p/&title=杂谈网络协议之种子与P2P | 派大星星星星&summary=最近学了些P2P协议相关的内容，做了些笔记。"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/weibo.png">
          
        </a>
      
    
      
        <a class='qrcode' rel="external nofollow noopener noreferrer" href='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACtUlEQVR42u3aQU7EMAwF0Ln/pYct0tDybceoQq+r0QCpXxaJsf16xc/72/P5zef3V5+TdZLVDj94eHh4g9CTIJIVkg26D/r+N5OY8fDw8LZ59y+4p96H3tumPJ5fLHh4eHgP4CUJbp4650Hj4eHh/Q9efnmcKn/g4eHhPYdXPbLnh3svQV+steDh4eHFvPyYfs7nlf4eHh4e3rirfn/g9o7jPH3Pr4HLaPHw8PAWePmBmzMmZYt8GKsQJx4eHt4yLzmg86ZUXopN/rZZOsHDw8Nb4yVl017SPLkY8lLvZYR4eHh4a7xqIpukuXlCXB0LKPf38PDw8BZ41UALY0+t4I519vDw8PCO8nol1PyneUMr2fR8ncv+Hh4eHt4h3vyMTYoRk4GqalL+qt4neHh4eId4+ehV3rKat7gKZWI8PDy8BV6vkFodGqiWaOc/xcPDw/tLXu+Y7l0w1aJG9SrCw8PD2+DNS6hnN6JajPhlTTw8PLw13ql2Vz4EkKfsyXZc/j4eHh7eGi/5Jz9PuHuN/0JZIb/S8PDw8BZ4CSY/7vMCbvW4711ReHh4eBu8PNnNX9kb2+qVdMs9PTw8PLwxr5cuJ+lvr/BafWNUwsDDw8Nb4BX+pY8XrabCvfS6l6zj4eHhzXkbh3VeqM3DbdZa8PDw8JZ589fn7bQk+c4LzfXJAjw8PLwpr9rOT8LKN+7U9VOuVePh4eENeEmg1bJpvk3ltla1y4eHh4d3iPcuPtVRgB6sNzX2wxvx8PDwFnjVAzfH9xpXvUZXGYOHh4c35iVBJwd9b8184/KLCg8PD+9veL2mV7LCgXspLkDg4eHhPZN3KinvJdnl9BoPDw/vMbxeGaI6ejUpheDh4eFt8/JCQDJAUB01yMOtFinw8PDwNni9Wa18I/JN7F0wh+sZeHh4eHfPF4/9St/jqjv7AAAAAElFTkSuQmCC'>
        
          <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/qrcode.png">
        
        </a>
      
    
  </div>
</div>



        
      
    </div>
  </section>


        
        
            <div class="prev-next">
                
                    <section class="prev">
                        <span class="art-item-left">
                            <h6><i class="fas fa-chevron-left" aria-hidden="true"></i>&nbsp;上一页</h6>
                            <h4>
                                <a href="/2020-01-26-yuv-pixel-formats/" rel="prev" title="详解 YUV 格式（I420/YUV420/NV12/NV12/YUV422）">
                                  
                                      详解 YUV 格式（I420/YUV420/NV12/NV12/YUV422）
                                  
                                </a>
                            </h4>
                            
                                
                                <h6 class="tags">
                                    <a class="tag" href="/tags/Audio-Video/"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>Audio/Video</a>
                                </h6>
                            
                        </span>
                    </section>
                
                
                    <section class="next">
                        <span class="art-item-right" aria-hidden="true">
                            <h6>下一页&nbsp;<i class="fas fa-chevron-right" aria-hidden="true"></i></h6>
                            <h4>
                                <a href="/2019-06-06-network-protocol-ip-tcp-udp/" rel="prev" title="杂谈网络协议之 TCP/IP">
                                    
                                        杂谈网络协议之 TCP/IP
                                    
                                </a>
                            </h4>
                            
                                
                                <h6 class="tags">
                                    <a class="tag" href="/tags/NetworkProtocol/"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>NetworkProtocol</a>
                                </h6>
                            
                        </span>
                    </section>
                
            </div>
        
      </section>
    </article>
  

  
    <!-- 显示推荐文章和评论 -->



  <article class="post white-box comments">
    <section class="article typo">
      <h4><i class="fas fa-comments fa-fw" aria-hidden="true"></i>&nbsp;评论</h4>
      
        <section id="comments">
          <div id="disqus_thread">
            <div><i class='fas fa-exclamation-triangle'>&nbsp;无法加载Disqus评论系统，请确保您的网络能够正常访问。</div>
          </div>
        </section>
      
      
      
      
    </section>
  </article>


  




<!-- 根据页面mathjax变量决定是否加载MathJax数学公式js -->



  <script>
    window.subData = {
      title: '杂谈网络协议之种子与P2P',
      tools: true
    }
  </script>


</div>
<aside class='l_side'>
  
    
    
      
        
          
          
            <section class='widget author'>
  <div class='content pure'>
    
      <div class='avatar'>
        <img class='avatar' src='https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190516125601.jpg'/>
      </div>
    
    
    
      <div class="social-wrapper">
        
          
            <a href="https://github.com/Fongim"
              class="social fab fa-github flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="mailto:me@paaatrick.com"
              class="social fas fa-envelope flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="https://me.csdn.net/fongim"
              class="social fab fa-contao flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
            </a>
          
        
      </div>
    
  </div>
</section>

          
        
      
        
          
          
            
  <section class='widget toc-wrapper'>
    
<header class='pure'>
  <div><i class="fas fa-list fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;本文目录</div>
  
    <div class='wrapper'><a class="s-toc rightBtn" rel="external nofollow noopener noreferrer" href="javascript:void(0)"><i class="fas fa-thumbtack fa-fw"></i></a></div>
  
</header>

    <div class='content pure'>
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#P2P"><span class="toc-text">P2P</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#torrent"><span class="toc-text">torrent</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DHT-去中心化网络"><span class="toc-text">DHT 去中心化网络</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#DHT-网络如何维护"><span class="toc-text">DHT 网络如何维护</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DHT-网络节点的查找"><span class="toc-text">DHT 网络节点的查找</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DHT-网络节点之间的沟通"><span class="toc-text">DHT 网络节点之间的沟通</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DHT-网络的更新"><span class="toc-text">DHT 网络的更新</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#磁力链接"><span class="toc-text">磁力链接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小结"><span class="toc-text">小结</span></a></li></ol>
    </div>
  </section>


          
        
      
        
          
          
            
  <section class='widget category'>
    
<header class='pure'>
  <div><i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;文章分类</div>
  
    <a class="rightBtn"
    
      rel="nofollow"
    
    
    href="/categories/"
    title="categories/">
    <i class="fas fa-expand-arrows-alt fa-fw"></i></a>
  
</header>

    <div class='content pure'>
      <ul class="entry">
        
          <li><a class="flat-box" title="/categories/Algorithm/" href="/categories/Algorithm/"><div class='name'>Algorithm</div><div class='badge'>(10)</div></a></li>
        
          <li><a class="flat-box" title="/categories/Life/" href="/categories/Life/"><div class='name'>Life</div><div class='badge'>(4)</div></a></li>
        
          <li><a class="flat-box" title="/categories/Note/" href="/categories/Note/"><div class='name'>Note</div><div class='badge'>(14)</div></a></li>
        
          <li><a class="flat-box" title="/categories/Tech/" href="/categories/Tech/"><div class='name'>Tech</div><div class='badge'>(15)</div></a></li>
        
      </ul>
    </div>
  </section>


          
        
      
        
          
          
            
  <section class='widget tagcloud'>
    
<header class='pure'>
  <div><i class="fas fa-fire fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;热门标签</div>
  
    <a class="rightBtn"
    
      rel="nofollow"
    
    
    href="/tags/"
    title="tags/">
    <i class="fas fa-expand-arrows-alt fa-fw"></i></a>
  
</header>

    <div class='content pure'>
      <a href="/tags/Algorithm/" style="font-size: 20px; color: #707070">Algorithm</a> <a href="/tags/Android/" style="font-size: 14px; color: #999">Android</a> <a href="/tags/Audio-Video/" style="font-size: 14px; color: #999">Audio/Video</a> <a href="/tags/CMake/" style="font-size: 14px; color: #999">CMake</a> <a href="/tags/CocoaPods/" style="font-size: 14px; color: #999">CocoaPods</a> <a href="/tags/Flutter/" style="font-size: 14px; color: #999">Flutter</a> <a href="/tags/Food/" style="font-size: 16px; color: #8b8b8b">Food</a> <a href="/tags/GN/" style="font-size: 14px; color: #999">GN</a> <a href="/tags/Hotel/" style="font-size: 14px; color: #999">Hotel</a> <a href="/tags/LeetCode/" style="font-size: 20px; color: #707070">LeetCode</a> <a href="/tags/NetworkProtocol/" style="font-size: 18px; color: #7e7e7e">NetworkProtocol</a> <a href="/tags/Ninja/" style="font-size: 14px; color: #999">Ninja</a> <a href="/tags/Objective-C/" style="font-size: 22px; color: #636363">Objective-C</a> <a href="/tags/Python/" style="font-size: 20px; color: #707070">Python</a> <a href="/tags/QuickLook/" style="font-size: 14px; color: #999">QuickLook</a> <a href="/tags/Swift/" style="font-size: 14px; color: #999">Swift</a> <a href="/tags/SwiftUI/" style="font-size: 14px; color: #999">SwiftUI</a> <a href="/tags/Windows/" style="font-size: 14px; color: #999">Windows</a> <a href="/tags/WordPress/" style="font-size: 16px; color: #8b8b8b">WordPress</a> <a href="/tags/iOS/" style="font-size: 24px; color: #555">iOS</a> <a href="/tags/macOS/" style="font-size: 14px; color: #999">macOS</a>
    </div>
  </section>


          
        
      
    

  
</aside>

<footer id="footer" class="clearfix">
  
  
    <div class="social-wrapper">
      
        
          <a href="https://github.com/Fongim"
            class="social fab fa-github flat-btn"
            target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="mailto:me@paaatrick.com"
            class="social fas fa-envelope flat-btn"
            target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="https://me.csdn.net/fongim"
            class="social fab fa-contao flat-btn"
            target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
    </div>
  
  <br>
  <div><p>©2019 派大星星星星</p>
</div>
  <div>
    本站使用
    <a href="https://xaoxuu.com/wiki/material-x/" target="_blank" class="codename">Material X</a>
    作为主题
    
      ，
      总访问量为
      <span id="busuanzi_value_site_pv"><i class="fas fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span>
      次
    
    。
  </div>
</footer>
<script>setLoadingBarProgress(80);</script>


      <script>setLoadingBarProgress(60);</script>
    </div>
    <a class="s-top fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>

  <script>
    var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
    var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
    var ALGOLIA_API_KEY = "";
    var ALGOLIA_APP_ID = "";
    var ALGOLIA_INDEX_NAME = "";
    var AZURE_SERVICE_NAME = "";
    var AZURE_INDEX_NAME = "";
    var AZURE_QUERY_KEY = "";
    var BAIDU_API_ID = "";
    var SEARCH_SERVICE = "hexo" || "hexo";
    var ROOT = "/"||"/";
    if(!ROOT.endsWith('/'))ROOT += '/';
  </script>

<script src="//instant.page/1.2.2" type="module" integrity="sha384-2xV8M5griQmzyiY3CDqh1dn4z3llDVqZDqzjzcY+jCBCk/a5fXJmuZ/40JJAPeoU"></script>


  <script async src="https://cdn.jsdelivr.net/npm/scrollreveal@4.0.5/dist/scrollreveal.min.js"></script>
  <script type="text/javascript">
    $(function() {
      const $reveal = $('.reveal');
      if ($reveal.length === 0) return;
      const sr = ScrollReveal({ distance: 0 });
      sr.reveal('.reveal');
    });
  </script>


  <script src="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.js"></script>
  <script type="text/javascript">
    $(function() {
      Waves.attach('.flat-btn', ['waves-button']);
      Waves.attach('.float-btn', ['waves-button', 'waves-float']);
      Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
      Waves.attach('.flat-box', ['waves-block']);
      Waves.attach('.float-box', ['waves-block', 'waves-float']);
      Waves.attach('.waves-image');
      Waves.init();
    });
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js"></script>




  
  
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script>
    <script type="text/javascript">
      $(function(){
        const images = ["https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190516120523.jpeg", "https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190516120522.jpeg", "https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190516120521.jpeg", "https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190516120520.jpeg", "https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190516120519.jpeg", "https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190516120518.jpeg", "https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190516120517.jpeg", "https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190516120516.jpeg", "https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190516120515.jpeg"];
        for (let i = 1; i < images.length; i++) {
          const random = Math.floor(Math.random() * (i + 1));
          [images[i], images[random]] = [images[random], images[i]];
        }
        if ('') {
          $('').backstretch(images, 
          {
            duration: "40000",
            fade: "2500"
          });
        } else {
          $.backstretch(images, 
          {
            duration: "40000",
            fade: "2500"
          });
        }
      });
    </script>
  





  <script>
    var disqus_shortname = 'paaatrick-com';
    
      var disqus_url = 'https://paaatrick.com/2019-07-07-network-protocol-p2p/';
    
    (function(){
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>







  <script src="/js/app.js"></script>


  <script src="/js/search.js"></script>




<!-- 复制 -->
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  let COPY_SUCCESS = "复制成功";
  let COPY_FAILURE = "复制失败";
  /*页面载入完成后，创建复制按钮*/
  !function (e, t, a) {
    /* code */
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '  <i class="fa fa-copy"></i><span>复制</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });

      clipboard.on('success', function(e) {
        //您可以加入成功提示
        console.info('Action:', e.action);
        console.info('Text:', e.text);
        console.info('Trigger:', e.trigger);
        success_prompt(COPY_SUCCESS);
        e.clearSelection();
      });
      clipboard.on('error', function(e) {
        //您可以加入失败提示
        console.error('Action:', e.action);
        console.error('Trigger:', e.trigger);
        fail_prompt(COPY_FAILURE);
      });
    }
    initCopyCode();

  }(window, document);

  /**
   * 弹出式提示框，默认1.5秒自动消失
   * @param message 提示信息
   * @param style 提示样式，有alert-success、alert-danger、alert-warning、alert-info
   * @param time 消失时间
   */
  var prompt = function (message, style, time)
  {
      style = (style === undefined) ? 'alert-success' : style;
      time = (time === undefined) ? 1500 : time*1000;
      $('<div>')
          .appendTo('body')
          .addClass('alert ' + style)
          .html(message)
          .show()
          .delay(time)
          .fadeOut();
  };

  // 成功提示
  var success_prompt = function(message, time)
  {
      prompt(message, 'alert-success', time);
  };

  // 失败提示
  var fail_prompt = function(message, time)
  {
      prompt(message, 'alert-danger', time);
  };

  // 提醒
  var warning_prompt = function(message, time)
  {
      prompt(message, 'alert-warning', time);
  };

  // 信息提示
  var info_prompt = function(message, time)
  {
      prompt(message, 'alert-info', time);
  };

</script>


<!-- fancybox -->
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script>
  let LAZY_LOAD_IMAGE = "";
  $(".article-entry").find("fancybox").find("img").each(function () {
      var element = document.createElement("a");
      $(element).attr("data-fancybox", "gallery");
      $(element).attr("href", $(this).attr("src"));
      /* 图片采用懒加载处理时,
       * 一般图片标签内会有个属性名来存放图片的真实地址，比如 data-original,
       * 那么此处将原本的属性名src替换为对应属性名data-original,
       * 修改如下
       */
       if (LAZY_LOAD_IMAGE) {
         $(element).attr("href", $(this).attr("data-original"));
       }
      $(this).wrap(element);
  });
</script>





  <script>setLoadingBarProgress(100);</script>
</body>
</html>
